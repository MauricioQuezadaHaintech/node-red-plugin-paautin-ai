<!-- Editor-side: config node form for paautin-ai-config -->

<script type="text/javascript">
    RED.nodes.registerType("paautin-ai-config", {
        category: "config",
        defaults: {
            name: { value: "Paautin AI" },
            mode: { value: "simple" },
            model: { value: "claude-sonnet-4-20250514" },
            serverUrl: { value: "" },
            projectPath: { value: "" },
            includeSkills: { value: true }
        },
        credentials: {
            apiKey: { type: "password" }
        },
        label: function () {
            return this.name || "Paautin AI Config";
        },
        oneditprepare: function () {
            var that = this;

            function toggleFields() {
                var mode = $("#node-config-input-mode").val();
                $(".paautin-ai-field-simple").toggle(mode === "simple");
                $(".paautin-ai-field-claudecode").toggle(mode === "claude-code");
                $(".paautin-ai-field-server").toggle(mode === "server");
            }

            $("#node-config-input-mode").on("change", toggleFields);
            toggleFields();
        }
    });
</script>

<script type="text/html" data-template-name="paautin-ai-config">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-config-input-name" placeholder="Paautin AI">
    </div>

    <div class="form-row">
        <label for="node-config-input-mode"><i class="fa fa-cog"></i> Mode</label>
        <select id="node-config-input-mode" style="width:70%">
            <option value="simple">API Directa (Simple)</option>
            <option value="claude-code">Claude Code Local</option>
            <option value="server">Servidor Remoto</option>
        </select>
    </div>

    <div class="form-row">
        <label for="node-config-input-apiKey"><i class="fa fa-key"></i> API Key</label>
        <input type="password" id="node-config-input-apiKey" placeholder="sk-ant-...">
    </div>

    <div class="form-row paautin-ai-field-simple">
        <label for="node-config-input-model"><i class="fa fa-microchip"></i> Model</label>
        <select id="node-config-input-model" style="width:70%">
            <option value="claude-opus-4-20250514">Claude Opus 4</option>
            <option value="claude-sonnet-4-20250514">Claude Sonnet 4</option>
            <option value="claude-haiku-4-20250506">Claude Haiku 4</option>
        </select>
    </div>

    <div class="form-row paautin-ai-field-claudecode">
        <label for="node-config-input-projectPath"><i class="fa fa-folder"></i> Project Path</label>
        <input type="text" id="node-config-input-projectPath" placeholder="/path/to/Paautin_node-red">
        <div class="form-tips" style="margin-top:4px">
            Directorio del proyecto Node-RED. Claude Code usara los skills y CLAUDE.md de este directorio.
            Si se deja vacio, usa el userDir de Node-RED.
        </div>
    </div>

    <div class="form-row paautin-ai-field-server">
        <label for="node-config-input-serverUrl"><i class="fa fa-cloud"></i> Server URL</label>
        <input type="text" id="node-config-input-serverUrl" placeholder="https://mi-servidor:3100">
        <div class="form-tips" style="margin-top:4px">
            URL del servidor remoto que ejecuta Claude Code. El plugin enviara requests a <code>{url}/chat</code>.
        </div>
    </div>

    <div class="form-row">
        <label for="node-config-input-includeSkills">
            <i class="fa fa-book"></i> Include Skills
        </label>
        <input type="checkbox" id="node-config-input-includeSkills" style="width:auto; margin-left:5px">
        <span style="margin-left:5px; font-size:12px; color:#888">
            Incluir contexto de skills en modo API Directa
        </span>
    </div>
</script>

<script type="text/html" data-help-name="paautin-ai-config">
    <p>Configuracion del asistente AI para Node-RED.</p>
    <h3>Modos</h3>
    <dl>
        <dt>API Directa (Simple)</dt>
        <dd>Llama a la API de Anthropic directamente. Necesita API Key. Claude no tiene acceso
            a archivos locales, pero recibe el flow activo como contexto.</dd>
        <dt>Claude Code Local</dt>
        <dd>Ejecuta el CLI <code>claude</code> como subproceso. Tiene acceso completo al
            proyecto: skills, CLAUDE.md, flow_bricks, herramientas de deploy. Requiere
            <code>claude</code> instalado en el servidor.</dd>
        <dt>Servidor Remoto</dt>
        <dd>Conecta a un endpoint remoto que ejecuta Claude Code. Util cuando Node-RED
            corre en un servidor y Claude Code esta en otro.</dd>
    </dl>
</script>
